<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPS - Sprungles Private Search</title>
    <link rel="stylesheet" href="https://fonts.bunny.net/css?family=orbitron:700|roboto:400,700">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="dark-mode">

    <nav class="main-nav">
        <div class="container">
            <a href="index.html" class="nav-logo">Natalie Spiva</a>
            <ul class="nav-links">
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#projects">Projects</a></li>
                <li><a href="resume.html">Resume</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="index.html#accomplishments" id="accomplishments-btn">Accomplishments</a></li>
                <li><a href="index.html#more-about-me" id="more-about-me-btn">More About Me</a></li>
            </ul>
            <div class="theme-switcher">
                <button data-theme="dark-mode" class="active">Dark</button>
                <button data-theme="light-mode">Light</button>
                <button data-theme="assisted-reading-mode">Assisted</button>
            </div>
        </div>
    </nav>

    <main class="container">
        <section id="sps" class="content-section">
            <h2 class="section-title">Sprungles Private Search</h2>
            <div style="text-align: center; max-width: 700px; margin: 0 auto;">
                <p>SPS is a privacy-respecting search engine that uses the DuckDuckGo API to provide instant answers. If no instant answer is found, it will fall back to a Google search. Your privacy is our priority.</p>
                <form id="sps-form" autocomplete="off" style="margin-top: 20px;">
                    <input type="text" id="sps-query" class="search-input" placeholder="Search the web privately..." autofocus>
                    <button type="submit" id="sps-button" class="btn">Search</button>
                </form>
            </div>
        </section>
        <section id="results-section"></section>
    </main>

    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchForm = document.getElementById('sps-form');
            const searchInput = document.getElementById('sps-query');
            const searchButton = document.getElementById('sps-button');
            const resultsSection = document.getElementById('results-section');

            searchForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const query = searchInput.value.trim();
                if (!query) return;

                resultsSection.innerHTML = '';
                searchButton.disabled = true;
                searchButton.textContent = "Searching...";
                
                try {
                    const apiUrl = `https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&t=sprunglessearch`;
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`Network response was not ok. Status: ${response.status}`);
                    
                    const data = await response.json();
                    
                    const noResults = !data.AbstractText && (!data.RelatedTopics || data.RelatedTopics.length === 0);

                    if (noResults) {
                        fallbackToGoogle(query);
                    } else {
                        displayAiStyleResults(data);
                    }

                } catch (error) {
                    console.error('Error fetching search results:', error);
                    displayError('Failed to generate a response. The DuckDuckGo API may be temporarily unavailable.');
                } finally {
                    searchButton.disabled = false;
                    searchButton.textContent = "Search";
                }
            });
            
            function fallbackToGoogle(query) {
                displayInfo('No instant answer found. Falling back to Google...');
                setTimeout(() => {
                    window.location.href = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                }, 2000);
            }

            function displayAiStyleResults(data) {
                resultsSection.innerHTML = '';
                let animationDelay = 0;

                if (data.AbstractText) {
                    const summaryCard = document.createElement('div');
                    summaryCard.className = 'card';
                    summaryCard.innerHTML = `
                        <h3>${data.Heading || 'Summary'}</h3>
                        <p>${data.AbstractText}</p>
                    `;
                    resultsSection.appendChild(summaryCard);
                }

                const sources = data.RelatedTopics;
                if (sources && sources.length > 0) {
                    const sourcesTitle = document.createElement('h3');
                    sourcesTitle.className = 'section-title';
                    sourcesTitle.textContent = 'Sources & Related Topics';
                    resultsSection.appendChild(sourcesTitle);

                    const cardGrid = document.createElement('div');
                    cardGrid.className = 'card-grid';
                    resultsSection.appendChild(cardGrid);

                    sources.forEach(item => {
                        if (item.Topics) {
                            item.Topics.forEach(subItem => {
                                displaySourceItem(subItem, cardGrid);
                            });
                        } else {
                            displaySourceItem(item, cardGrid);
                        }
                    });
                }
            }

            function displaySourceItem(item, container) {
                if (!item.FirstURL || !item.Text) return;

                const sourceCard = document.createElement('div');
                sourceCard.className = 'card';
                
                sourceCard.innerHTML = `
                    <h3><a href="${item.FirstURL}" target="_blank" rel="noopener noreferrer">${item.Text}</a></h3>
                    <p>${item.FirstURL}</p>
                `;
                container.appendChild(sourceCard);
            }

            function displayError(message) {
                resultsSection.innerHTML = `<div class="card"><p>${message}</p></div>`;
            }
            
            function displayInfo(message) {
                resultsSection.innerHTML = `<div class="card"><p>${message}</p></div>`;
            }
        });
    </script>

</body>
</html>
